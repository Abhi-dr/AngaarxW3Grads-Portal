{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%2210 0 100 100%22><text y=%22.90em%22 font-size=%2290%22>ðŸ”¥</text></svg>">
  <title>
    #ANGAARI_HAI
  </title>
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="{% static 'css/nucleo-icons.css' %}" rel="stylesheet" />
  <link href="{% static 'css/nucleo-svg.css' %}" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link href="{% static 'css/accounts/nucleo-svg.css' %}" rel="stylesheet" />
  <!-- CSS Files -->
  <link id="pagestyle" href="{% static 'css/accounts/argon-dashboard.css' %}" rel="stylesheet" />

  <style>
    body {
      background-image: url("{% static 'img/accounts/login_bg.jpg' %}");
      background-size: contain;

      background-attachment: fixed;

    }

    .star {
      color: red;
      display: inline;
    }

    .input-container {
      position: relative;
    }

    .validation-icon {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      background-size: cover;
      display: none;
    }

    #password-input:valid+.validation-icon {
      background-image: url('https://img.icons8.com/glyph-neue/64/40C057/double-tick.png');
      /* Replace with your green check icon image path */
      display: block;
    }

    #password-input:invalid+.validation-icon {
      background-image: url('https://img.icons8.com/emoji/48/cross-mark-emoji.png');
      /* Replace with your red cross icon image path */
      display: block;
    }
  </style>
</head>

<body class="w-100" oncontextmenu="return false">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg position-absolute top-0 z-index-3 w-100 shadow-none my-3 navbar-transparent mt-4">
    <div class="container">
      <a class="navbar-brand font-weight-bolder ms-lg-0 ms-3 text-white" href="{% url 'home' %}">
        The Angaar BatchðŸ”¥
      </a>

      <!-- <button class="navbar-toggler shadow-none ms-2" type="button" data-bs-toggle="collapse"
        data-bs-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon mt-2">
          <span class="navbar-toggler-bar bar1"></span>
          <span class="navbar-toggler-bar bar2"></span>
          <span class="navbar-toggler-bar bar3"></span>
        </span></button> -->
      <a class="btn btn-outline-white" href="{% url 'home' %}">
        Home
      </a>
    </div>

  </nav>
  <!-- End Navbar -->
  <main class="main-content  mt-0">
    <div class="page-header align-items-start min-vh-50 pt-6 pb-11 m-3 border-radius-lg"
      style="background-image: url('/static/img/accounts/register.png'); background-position: center;">
      <span class="mask bg-gradient-dark opacity-6"></span>
      <div class="container">
        {% for message in messages %}

        <div class="row">
          <div class="alert {{ message.tags }} fade show" role="alert">
            <span class="alert-text text-white"><strong>{{ message.tag }}</strong>{{ message }}</span>
          </div>
        </div>

        {% endfor %}

        <div class="row justify-content-center">
          <div class="col-lg-5 text-center mx-auto">
            <h1 class="text-white mb-2 mt-5">Swagat Hai!</h1>
            <p class="text-lead text-white">
              Seekhna Hai, Seekh! Jeetna Hai, Jeet!
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row mt-lg-n10 mt-md-n11 mt-n10 justify-content-center">

        <div class="col-xl-7 col-lg-5 col-md-7">
          <div class="card z-index-0" style="border: 1px solid rgb(255, 150, 63);">
            <div class="card-header text-center">
              <h5>Step Forward To Learn and Earn, What? Skills </h5>
            </div>
            <div class="card-body">

              <form role="form" method="post">
                {% csrf_token %}

                <div class="mb-3">
                  <label for="username" class="form-label">Username</label>
                  <input type="text" class="form-control" id="username" name="username"
                    placeholder="Enter your username" pattern="^(?!.*\s).{4,30}$" maxlength="30" minlength="4"
                    title="Must NOT contain spaces, must be between 4-30 characters" required>
                  <span id="username-feedback"></span>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <label for="first_name" class="form-label">First Name</label>
                    <input type="text" class="form-control" name="first_name" maxlength="30"
                      placeholder="Enter your First name..." required>
                  </div>

                  <div class="col-md-6">
                    <label for="last_name" class="form-label">Last Name</label>
                    <input type="text" class="form-control" name="last_name" maxlength="20"
                    placeholder="Enter your Last name...">
                  </div>
                </div>

                <div class="mb-3">
                  <label for="email" class="form-label">Email Address</label>
                  <input type="email" class="form-control" name="email" id="email" maxlength="60" required
                  placeholder="Enter your Email here...">
                  <span id="email-feedback"></span>
                </div>

                <div class="mb-3">
                  <label for="password" class="form-label">Password</label>
                  <input type="password" class="form-control" name="password" id="password" minlength="8" required
                    pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*]).{8,}$"
                    placeholder="Enter your Password..."
                    title="Must contain at least one number, one uppercase, one lowercase, one special character, and at least 8 characters">
                </div>

                <div class="mb-3">
                  <label for="confirm_password" class="form-label">Confirm Password</label>
                  <input type="password" class="form-control" name="confirm_password"
                  placeholder="Enter the same password again..."
                   id="confirm-password" required>
                  <div id="password-match" style="color: red; display: none;">Passwords do not match!</div>
                </div>

                <div class="text-center">
                  <button type="submit" class="btn bg-gradient-dark w-100 my-4 mb-2 mybtn" id="signup-button"
                    disabled>Register</button>
                </div>

                <p class="text-sm mt-3 mb-0 text-center">Already have an account? <a href="{% url 'login' %}"
                    class="text-dark font-weight-bolder">Login</a></p>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function () {
      $("#username").on("input", function () {
        let username = $(this).val();
        if (username.length >= 4) {
          $.ajax({
            url: "{% url 'check_username_availability' %}",
            data: { 'username': username },
            dataType: 'json',
            success: function (data) {
              if (data.is_available) {
                $("#username-feedback").html("<span style='color:green;'>Username is available</span>");
                enableSubmit();
              } else {
                $("#username-feedback").html("<span style='color:red;'>Username is taken</span>");
                disableSubmit();
              }
            }
          });
        } else {
          $("#username-feedback").empty();
          disableSubmit();
        }
      });

      $("#email").on("input", function () {
        let email = $(this).val();
        if (email.length > 5) {
          $.ajax({
            url: "{% url 'check_email_availability' %}",
            data: { 'email': email },
            dataType: 'json',
            success: function (data) {
              if (data.is_available) {
                $("#email-feedback").html("<span style='color:green;'>Email is available</span>");
                enableSubmit();
              } else {
                $("#email-feedback").html("<span style='color:red;'>Email already registered</span>");
                disableSubmit();
              }
            }
          });
        } else {
          $("#email-feedback").empty();
          disableSubmit();
        }
      });

      $("#password, #confirm-password").on("input", function () {
        if ($("#password").val() !== $("#confirm-password").val()) {
          $("#password-match").show();
          disableSubmit();
        } else {
          $("#password-match").hide();
          enableSubmit();
        }
      });

      function enableSubmit() {
        if (validForm()) {
          $("#signup-button").prop("disabled", false).text("Register");
        }
      }

      function disableSubmit() {
        $("#signup-button").prop("disabled", true).text("Cannot Register");
      }

      function validForm() {
        return $("#username-feedback").text().includes("available") &&
          $("#email-feedback").text().includes("available") &&
          $("#password-match").is(":hidden");
      }
    });
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>

</body>

</html>