{% extends "administration/base.html" %}
{% load static %}

{% block title %}
{{ sheet.name }} | Add Question
{% endblock %}

{% block sheet_active %}
active
{% endblock %}

{% block body %}

<div class="container-fluid">
    {% for message in messages %}

    <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
        <strong>{{ message.tag }}</strong> {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    {% endfor %}

    <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item pe-auto">
                <a href="{% url 'administrator_sheet' sheet.slug %}">{{ sheet.name }}</a>
            </li>

            </li>
            <li class="breadcrumb-item active" aria-current="page">Add Question</li>
        </ol>
    </nav>


    <div class="card">
        <div class="card-body">
            <h5 class="card-title fw-semibold mb-0">Add Question to {{ sheet.name }}</i> </h5>

        </div>
        <div class="container px-4">
            <form method="POST">
                {% csrf_token %}

                <hr class="mt-0">
                <div class="row">
                    <div class="w-100 mt-n4">

                        <div class="card-body h-100">

                            <div class="mb-3">
                                <label for="job_title" class="form-label">Title
                                    <div class="star">*</div>
                                </label>
                                <input type="text" class="form-control" id="question_title" name="title"
                                    placeholder="Title goes here..." required>
                            </div>


                            <div class="mb-3">
                                <label for="job_title" class="form-label">Scenario <small>(optional)</small>
                                    <div class="star"></div>
                                </label>
                                <textarea class="form-control" id="question_description" name="scenario" rows="5"
                                    placeholder="Scenario here..."></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="job_title" class="form-label">Problem Description
                                    <div class="star">*</div>
                                </label>
                                <textarea class="form-control" id="question_description" name="description" rows="5"
                                    placeholder="Description here..." required></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="job_title" class="form-label">Input Format
                                    <div class="star">*</div>
                                </label>
                                <textarea class="form-control" id="input_format" name="input_format" rows="5"
                                    placeholder="Input format here..." required></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="job_title" class="form-label">Output Format
                                    <div class="star">*</div>
                                </label>
                                <textarea class="form-control" id="output_format" name="output_format" rows="5"
                                    placeholder="Output format here..." required></textarea>
                            </div>



                            <div class="mb-3">
                                <label for="job_title" class="form-label">Constraints
                                    <div class="star">*</div>
                                </label>
                                <textarea class="form-control" id="question_description" name="constraints" rows="5"
                                    placeholder="Description here..." required></textarea>
                            </div>

                            <div class="mb-3">
                                <label for="job_title" class="form-label">Hint <small>(optional)</small>
                                </label>
                                <textarea class="form-control" id="question_description" name="hint" rows="3"
                                    placeholder="Hint here..."></textarea>
                            </div>


                            <div>
                                <div class="mb-3 rounded border border-white p-3">
                                    <!-- ========== RECOMMENDED QUESTIONS SECTION ===========-->
                                    <label>Recommended Questions <small>(optional)</small></label>
                                    <div id="recommended-questions-container">

                                    </div>

                                    <!-- Add More Questions Button -->
                                    <button type="button" class="btn btn-outline-primary mt-2 w-100" id="add-question-btn">Add
                                        Similar
                                        Questions</button>

                                    <!-- Hidden input to store recommended questions data -->
                                    <input type="hidden" id="recommended-questions-data" name="recommended_questions"
                                        value="[]">
                                </div>
                            </div>


                            <div class="mb-3">
                                <label for="assignment_type" class="form-label">Difficulty Level
                                    <div class="star">*</div>
                                </label>
                                <select class="form-select form-control" name="difficulty_level" id="assignment_type"
                                    required>
                                    <!-- <option value="" selected disabled>Select Level</option> -->
                                    <option value="Easy">Easy</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Hard">Hard</option>

                                </select>
                            </div>

                            <div>
                                <div class="col-md-12">
                                    <button type="submit" class="btn btn-success w-100 mt-3">Add &nbsp;
                                        Question</button>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </form>

        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const questionsContainer = document.getElementById("recommended-questions-container");
        const addQuestionBtn = document.getElementById("add-question-btn");
        const recommendedQuestionsInput = document.getElementById("recommended-questions-data");
        const form = document.querySelector("form");

        let recommendedQuestions = [];  // Store recommended questions

        // Function to create a recommended question group
        function createRecommendedQuestion(index, title = "", platform = "LeetCode", link = "") {
            let newQuestionGroup = document.createElement("div");
            newQuestionGroup.classList.add("recommended-question-group", "row", "rounded", "border", "border-white", "p-3", "m-3");
            newQuestionGroup.dataset.index = index;

            newQuestionGroup.innerHTML = `
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-control recommended-title" placeholder="Title here..." value="${title}">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label">Platform</label>
                        <select class="form-select recommended-platform">
                            <option class="text-black" value="LeetCode" ${platform === "LeetCode" ? "selected" : ""}>LeetCode</option>
                            <option class="text-black" value="GeeksForGeeks" ${platform === "GeeksForGeeks" ? "selected" : ""}>GeeksForGeeks</option>
                            <option class="text-black" value="HackerRank" ${platform === "HackerRank" ? "selected" : ""}>HackerRank</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Link</label>
                        <input type="text" class="form-control recommended-link" placeholder="Link here..." value="${link}">
                    </div>
                </div>
                <div class="">
                    <button type="button" class="btn btn-danger remove-question-btn w-100">Remove</button>
                </div>
            `;

            // Attach event listener to remove button
            newQuestionGroup.querySelector(".remove-question-btn").addEventListener("click", function () {
                recommendedQuestions.splice(index, 1);  // Remove from array
                renderQuestions();  // Re-render the list
            });

            // Update values on change
            newQuestionGroup.querySelector(".recommended-title").addEventListener("input", function () {
                recommendedQuestions[index].title = this.value;
            });
            newQuestionGroup.querySelector(".recommended-platform").addEventListener("change", function () {
                recommendedQuestions[index].platform = this.value;
            });
            newQuestionGroup.querySelector(".recommended-link").addEventListener("input", function () {
                recommendedQuestions[index].link = this.value;
            });

            return newQuestionGroup;
        }

        // Function to render recommended questions dynamically
        function renderQuestions() {
            questionsContainer.innerHTML = "";  // Clear container
            recommendedQuestions.forEach((rq, index) => {
                questionsContainer.appendChild(createRecommendedQuestion(index, rq.title, rq.platform, rq.link));
            });
        }

        // Add new recommended question on button click
        addQuestionBtn.addEventListener("click", function () {
            recommendedQuestions.push({ title: "", platform: "LeetCode", link: "" });
            renderQuestions();
        });

        // Handle form submission
        form.addEventListener("submit", function (event) {
            event.preventDefault();  // Prevent default form submission

            // Update the hidden input field before sending
            recommendedQuestionsInput.value = JSON.stringify(recommendedQuestions);

            form.submit();  // Submit the form
        });

        // Initial render
        renderQuestions();
    });
</script>

{% endblock %}